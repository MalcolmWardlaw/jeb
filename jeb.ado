capture program drop jeb
program define jeb
   version 9.2
   syntax [,map(string) notjeb1(string) notjeb2(string)]

   // Define not Jeb
   if mi("`notjeb1'") {
      local notjeb1 "Not Jeb"
   }

   if mi("`notjeb2'") {
      local notjeb2 "Not Jeb"
   }

   // Define Jeb

   tempname handle
   tempfile output
   file open `handle' using "`output'", write
   file write `handle' "dictionary {"_n" double  _X"_n" double  _Y"_n"}"_n" . ."_n" .662 0"_n" .662 0"_n" .662 0"_n" .29 0"_n" .29 0"_n" .292 .0091"_n" .298 .0143"_n" .299 .01755"_n" .301 .02015"_n" .301 .02795"_n" .301 .03055"_n" .301 .03055"_n" .3 .0403"_n" .3 .0403"_n" .3 .0403"_n" .288 .0637"_n" .288 .0637"_n" .288 .0637"_n" .273 .0988"_n" .273 .0988"_n" .268 .1105"_n" .263 .115"_n" .26 .1287"_n" .258 .1352"_n" .259 .1365"_n" .258 .1417"_n" .258 .1417"_n" .257 .1508"_n" .257 .1508"_n" .257 .1508"_n" .257 .1671"_n" .257 .1671"_n" .257 .1742"_n" .258 .1814"_n" .255 .1878"_n" .255 .1878"_n" .254 .1878"_n" .254 .1878"_n" .253 .1846"_n" .252 .1807"_n" .249 .1774"_n" .247 .1749"_n" .244 .1749"_n" .242 .1716"_n" .219 .1696"_n" .209 .1651"_n" .202 .1625"_n" .196 .1573"_n" .19 .1547"_n" .19 .1547"_n" .162 .1489"_n" .162 .1489"_n" .146 .1449"_n" .13 .1404"_n" .113 .1404"_n" .1 .1404"_n" .1 .1417"_n" .089 .1449"_n" .089 .1449"_n" .081 .1462"_n" .081 .1462"_n" .072 .1489"_n" .064 .154"_n" .058 .1605"_n" .058 .1605"_n" .048 .1755"_n" .048 .1755"_n" .046 .1781"_n" .042 .1807"_n" .041 .1833"_n" .041 .1833"_n" .04 .1918"_n" .04 .1918"_n" .038 .1996"_n" .036 .2074"_n" .035 .2158"_n" .034 .2236"_n" .034 .2314"_n" .031 .2386"_n" .029 .2437"_n" .027 .2502"_n" .023 .2548"_n" .02 .2587"_n" .016 .2613"_n" .014 .2652"_n" .011 .2717"_n" .011 .2795"_n" .011 .286"_n" .011 .286"_n" .013 .3029"_n" .013 .3029"_n" .014 .3049"_n" .013 .3075"_n" .015 .3094"_n" .017 .3107"_n" .025 .312"_n" .027 .312"_n" .091 .3296"_n" .094 .3282"_n" .098 .3263"_n" .101 .3244"_n" .104 .3211"_n" .107 .3172"_n" .107 .3172"_n" .123 .2867"_n" .123 .2867"_n" .125 .2814"_n" .129 .2723"_n" .135 .2691"_n" .138 .2671"_n" .145 .2678"_n" .149 .2678"_n" .151 .2678"_n" .155 .2671"_n" .157 .2678"_n" .161 .2691"_n" .164 .2737"_n" .167 .2769"_n" .167 .2769"_n" .177 .2834"_n" .177 .2834"_n" .177 .2834"_n" .185 .2944"_n" .185 .2944"_n" .185 .2944"_n" .205 .3152"_n" .205 .3152"_n" .205 .3152"_n" .221 .3263"_n" .221 .3263"_n" .228 .3315"_n" .236 .3399"_n" .243 .3432"_n" .251 .3464"_n" .26 .3464"_n" .268 .3464"_n" .268 .3464"_n" .293 .3478"_n" .293 .3478"_n" .293 .3478"_n" .307 .3484"_n" .307 .3484"_n" .307 .3484"_n" .314 .3478"_n" .314 .3478"_n" .322 .3478"_n" .327 .3497"_n" .317 .3614"_n" .325 .3549"_n" .43 .338"_n" .462 .3627"_n" .464 .3646"_n" .466 .3659"_n" .469 .3673"_n" .471 .3673"_n" .473 .3673"_n" .48 .3673"_n" .482 .3653"_n" .479 .3588"_n" .476 .3517"_n" .472 .3497"_n" .472 .3406"_n" .472 .3341"_n" .473 .3341"_n" .474 .3296"_n" .474 .3296"_n" .475 .3205"_n" .475 .3205"_n" .477 .3172"_n" .481 .3146"_n" .484 .3133"_n" .489 .31"_n" .507 .3055"_n" .514 .3035"_n" .514 .3035"_n" .539 .2944"_n" .539 .2944"_n" .539 .2944"_n" .557 .2873"_n" .557 .2873"_n" .565 .2834"_n" .587 .2671"_n" .595 .2606"_n" .601 .2555"_n" .608 .2483"_n" .615 .2437"_n" .615 .2437"_n" .626 .2379"_n" .626 .2379"_n" .636 .2334"_n" .639 .234"_n" .648 .2268"_n" .655 .2217"_n" .655 .2165"_n" .666 .2145"_n" .668 .2139"_n" .67 .2139"_n" .672 .2139"_n" .677 .2145"_n" .681 .219"_n" .686 .221"_n" .69 .2236"_n" .698 .2236"_n" .702 .2223"_n" .706 .221"_n" .708 .2184"_n" .711 .2158"_n" .716 .2099"_n" .721 .2034"_n" .729 .2034"_n" .732 .2041"_n" .746 .2067"_n" .748 .208"_n" .752 .2106"_n" .754 .2152"_n" .757 .2184"_n" .761 .2217"_n" .766 .2236"_n" .771 .2249"_n" .784 .2301"_n" .792 .2314"_n" .806 .2334"_n" .806 .2334"_n" .825 .2346"_n" .855 .2009"_n" .857 .1969"_n" .858 .1943"_n" .861 .1865"_n" .859 .1878"_n" .86 .184"_n" .861 .1807"_n" .863 .1781"_n" .862 .1749"_n" .861 .1716"_n" .857 .1703"_n" .855 .169"_n" .855 .169"_n" .849 .1638"_n" .849 .1638"_n" .849 .1638"_n" .843 .1605"_n" .843 .1605"_n" .84 .1593"_n" .838 .1567"_n" .836 .1547"_n" .826 .1469"_n" .805 .1417"_n" .8 .1404"_n" .8 .1404"_n" .779 .13"_n" .779 .13"_n" .767 .1241"_n" .751 .1163"_n" .738 .1138"_n" .726 .1111"_n" .716 .1124"_n" .704 .1138"_n" .704 .1138"_n" .685 .1157"_n" .685 .1157"_n" .685 .1157"_n" .647 .1248"_n" .647 .1248"_n" .644 .1255"_n" .635 .1287"_n" .633 .1274"_n" .631 .1255"_n" .631 .1229"_n" .631 .1202"_n" .631 .1202"_n" .633 .1138"_n" .633 .1138"_n" .634 .1111"_n" .633 .1053"_n" .634 .1021"_n" .634 .09425"_n" .64 .0871"_n" .642 .0793"_n" .642 .0793"_n" .648 .05655"_n" .648 .05655"_n" .648 .05655"_n" .652 .0468"_n" .652 .0468"_n" .652 .0468"_n" .658 .0312"_n" .658 .0312"_n" .66 .026"_n" .662 .0234"_n" .662 .01755"_n" .662 .01755"_n" . ."_n" .027 .312"_n" .026 .3224"_n" .026 .3224"_n" .026 .3224"_n" .023 .3289"_n" .023 .3289"_n" .018 .3419"_n" .009 .3627"_n" .006 .3757"_n" .006 .3757"_n" .005 .3829"_n" .005 .3829"_n" .005 .3881"_n" .004 .39"_n" .004 .3952"_n" .004 .3952"_n" .004 .4179"_n" .004 .4179"_n" .004 .4277"_n" 0 .4335"_n" 0 .4426"_n" 0 .4426"_n" 0 .5902"_n" 0 .5902"_n" 0 .6012"_n" .006 .6129"_n" .01 .624"_n" .011 .6279"_n" .014 .6409"_n" .016 .6435"_n" .02 .65"_n" .028 .6474"_n" .031 .6429"_n" .033 .6409"_n" .033 .6383"_n" .033 .6357"_n" .033 .6357"_n" .033 .6247"_n" .033 .6247"_n" .032 .6188"_n" .032 .6169"_n" .027 .6136"_n" .032 .6051"_n" .035 .585"_n" .03 .5726"_n" .03 .5726"_n" .026 .5629"_n" .026 .5629"_n" .028 .5635"_n" .029 .5642"_n" .031 .5642"_n" .036 .5642"_n" .044 .559"_n" .045 .5544"_n" .047 .5499"_n" .045 .5369"_n" .043 .5323"_n" .042 .5298"_n" .038 .5226"_n" .038 .5206"_n" .039 .5181"_n" .042 .5154"_n" .044 .5141"_n" .044 .5141"_n" .058 .5031"_n" .058 .5031"_n" .064 .4992"_n" .069 .5057"_n" .072 .5102"_n" .076 .5148"_n" .077 .52"_n" .079 .5259"_n" .08 .5291"_n" .083 .5336"_n" .086 .5369"_n" .09 .5427"_n" .096 .5441"_n" .101 .5375"_n" .101 .5356"_n" .101 .5336"_n" .101 .5317"_n" .101 .5122"_n" .095 .5031"_n" .087 .4875"_n" .084 .481"_n" .086 .4693"_n" .086 .4615"_n" .086 .4615"_n" .086 .455"_n" .086 .455"_n" .085 .4498"_n" .086 .4479"_n" .084 .4426"_n" .084 .4394"_n" .082 .4368"_n" .08 .4335"_n" .08 .4335"_n" .075 .4193"_n" .075 .4193"_n" .073 .4121"_n" .071 .3978"_n" .071 .39"_n" .071 .3848"_n" .074 .3705"_n" .076 .3653"_n" .076 .3653"_n" .079 .3588"_n" .079 .3588"_n" .079 .3588"_n" .082 .3503"_n" .082 .3503"_n" .082 .3503"_n" .089 .3322"_n" .089 .3322"_n" .091 .3296"_n" .027 .312"_n" . ."_n" .825 .2346"_n" .828 .2359"_n" .84 .2457"_n" .843 .249"_n" .849 .2541"_n" .864 .2671"_n" .867 .2737"_n" .867 .2756"_n" .867 .286"_n" .867 .2893"_n" .867 .2951"_n" .865 .3133"_n" .863 .3185"_n" .861 .3224"_n" .859 .3237"_n" .857 .327"_n" .856 .3296"_n" .853 .3361"_n" .856 .338"_n" .857 .3387"_n" .858 .3393"_n" .86 .3393"_n" .865 .3393"_n" .868 .3361"_n" .871 .3315"_n" .871 .3315"_n" .878 .3185"_n" .878 .3185"_n" .879 .3159"_n" .88 .3126"_n" .882 .3107"_n" .885 .3081"_n" .892 .3088"_n" .896 .31"_n" .904 .3126"_n" .912 .3172"_n" .918 .3224"_n" .925 .3289"_n" .929 .3373"_n" .934 .3452"_n" .934 .3452"_n" .942 .3575"_n" .942 .3575"_n" .944 .3608"_n" .945 .3646"_n" .949 .3666"_n" .958 .3711"_n" .956 .362"_n" .954 .3575"_n" .954 .3575"_n" .943 .3322"_n" .943 .3322"_n" .943 .3322"_n" .938 .3244"_n" .938 .3244"_n" .938 .3244"_n" .945 .3302"_n" .945 .3302"_n" .95 .3341"_n" .951 .3335"_n" .956 .3393"_n" .956 .3393"_n" .971 .3588"_n" .971 .3588"_n" .974 .3608"_n" .982 .3634"_n" .985 .3601"_n" .985 .3594"_n" .985 .3588"_n" .986 .3575"_n" .992 .3594"_n" .996 .3562"_n" .994 .3503"_n" .994 .3503"_n" .99 .3432"_n" .99 .3432"_n" .99 .3432"_n" .986 .3354"_n" .986 .3354"_n" .986 .3354"_n" .977 .3198"_n" .977 .3198"_n" .98 .3217"_n" .984 .325"_n" .987 .3263"_n" .997 .3282"_n" 1 .3205"_n" .996 .314"_n" .994 .31"_n" .989 .3068"_n" .986 .3035"_n" .986 .3035"_n" .964 .2788"_n" .964 .2788"_n" .958 .2723"_n" .95 .2646"_n" .941 .2606"_n" .941 .2606"_n" .925 .2555"_n" .925 .2555"_n" .921 .2535"_n" .919 .2522"_n" .915 .2502"_n" .915 .2502"_n" .909 .2483"_n" .909 .2483"_n" .909 .2483"_n" .898 .2399"_n" .898 .2399"_n" .898 .2399"_n" .887 .2314"_n" .887 .2314"_n" .887 .2314"_n" .87 .2152"_n" .87 .2152"_n" .87 .2152"_n" .857 .2034"_n" .857 .2034"_n" .855 .2009"_n" .825 .2346"_n" . ."_n" .317 .3614"_n" .311 .3673"_n" .311 .3673"_n" .305 .3744"_n" .305 .3744"_n" .299 .3809"_n" .29 .3874"_n" .286 .3946"_n" .283 .4004"_n" .286 .4056"_n" .285 .4095"_n" .285 .4095"_n" .283 .4258"_n" .283 .4258"_n" .283 .4296"_n" .285 .4309"_n" .285 .4342"_n" .286 .4394"_n" .282 .4433"_n" .283 .4491"_n" .285 .4628"_n" .291 .4667"_n" .299 .4771"_n" .303 .481"_n" .305 .4862"_n" .309 .4894"_n" .309 .4894"_n" .325 .4999"_n" .325 .4999"_n" .325 .4999"_n" .335 .505"_n" .335 .505"_n" .341 .5096"_n" .35 .5174"_n" .358 .5181"_n" .36 .5181"_n" .363 .5174"_n" .365 .5174"_n" .365 .5161"_n" .365 .5154"_n" .367 .5141"_n" .368 .5129"_n" .371 .5129"_n" .373 .5122"_n" .378 .5115"_n" .381 .5109"_n" .385 .5083"_n" .392 .5038"_n" .394 .5024"_n" .399 .496"_n" .402 .4934"_n" .409 .4843"_n" .412 .4829"_n" .416 .4797"_n" .429 .4778"_n" .432 .4738"_n" .435 .4706"_n" .433 .4667"_n" .433 .4641"_n" .434 .4622"_n" .435 .4589"_n" .436 .457"_n" .439 .4524"_n" .443 .4524"_n" .446 .4491"_n" .448 .4466"_n" .448 .4433"_n" .449 .4407"_n" .449 .4407"_n" .463 .4205"_n" .463 .4205"_n" .466 .4167"_n" .473 .4121"_n" .473 .4069"_n" .473 .4011"_n" .468 .3991"_n" .466 .3946"_n" .466 .3946"_n" .464 .3867"_n" .464 .3867"_n" .464 .3867"_n" .462 .3809"_n" .462 .3809"_n" .459 .3744"_n" .459 .3679"_n" .46 .3614"_n" .462 .3627"_n" .43 .338"_n" .325 .3549"_n" .317 .3614"_n
   file close `handle'
   qui infile using "`output'", clear
   local last_jeb_obs = _N
   qui gen jeb = 1


   if mi("`map'") {
      local map "usa_map"
   }

   if ! (substr(`"`map'"',-4,4)==".dta") {
      local map "`map'.dta"
   }

   capture findfile "`map'"
   if _rc == 0 {
      local mapfile = r(fn)
      append using `mapfile'
   }
   else {
      capture append using "https://malcolmwardlaw.github.io/jeb/usa_map" 
   }

   if _rc ==0 {
      qui replace jeb = 0 if mi(jeb)
      qui sum _X if _n > `last_jeb_obs'
      local xmin = r(min) - abs(r(min))*.01
      local xmax = r(max) + abs(r(max))*.01

      qui sum _Y if _n > `last_jeb_obs'
      local ymin = r(min) - abs(r(max))*.0
      local ymax = r(max) + abs(r(max))*.01
      local aspect = (`ymax' - `ymin')/(`xmax' - `xmin')

      local jeb_xmin = `xmin' + (`xmax' - `xmin') * .03
      local jeb_xmax = `xmax' - (`xmax' - `xmin') * .03

      qui replace _X = `jeb_xmin' + (`jeb_xmax' - `jeb_xmin') * _X in 1/`last_jeb_obs'

      qui replace _Y = `ymin' + (`jeb_xmax' - `jeb_xmin') * _Y  in 1/`last_jeb_obs'

   }
   else {
      qui sum _X 
      local xmin = r(min) - abs(r(min))*.01
      local xmax = r(max) + abs(r(max))*.01

      qui sum _Y 
      local ymin = r(min) - abs(r(max))*.01
      local ymax = r(max) + abs(r(max))*.01
      local aspect = (`ymax' - `ymin')/(`xmax' - `xmin')
   }


   tempvar _temp
   qui gen `_temp' = _n if mi(_X)
   qui sum `_temp' if _n>1 

   local first_p2_obs = `r(min)'
   local last_p1_obs = `r(min)' - 1

   tempvar partnum
   qui gen `partnum' = 2 in 1/`last_p1_obs'
   qui replace `partnum' = 1 in `first_p2_obs'/`last_jeb_obs'
   qui replace `partnum' = 0 if _n >  `last_jeb_obs'

   local ysize = 4
   local xsize = `ysize'/`aspect'
   
   if c(stata_version) >= 15 {
      local LA `"la("center")"'
   }

   di as result "Jeb!"
   graph twoway (area _Y _X if 0, nodropbase cmissing(n) fc("red") fi(100) lc("black") lw("thin") lp("solid") `LA') (area _Y _X if 0, nodropbase cmissing(n) fc("blue") fi(100) lc("black") lw("thin") lp("solid") `LA') (area _Y _X if `partnum' == 0, nodropbase cmissing(n) fc("yellow") fi(100) lc("black") lw("thin") lp("solid") `LA') (area _Y _X if `partnum' == 1, nodropbase cmissing(n) fc("234 192 134") fi(100) lc("black") lw("thin") lp("solid") `LA' leg(off)) (area _Y _X if `partnum' == 2, nodropbase cmissing(n) fc("190 212 255") fi(100) lc("black") lw("thin") lp("solid") `LA' )  , ysize(`ysize') xsize(`xsize') aspect(`aspect') yscale(r(`ymin' `ymax') off) xscale(r(`xmin' `xmax') off) ylabel(`ymin' `ymax') xlabel(`xmin' `xmax') ytitle("") xtitle("")  plotregion(margin(zero) style(none)) graphregion(margin(zero) style(none)) scheme(s1mono) title("{fontface Baskerville Bold:Jeb!} ",  size(*3.5) color(cranberry)  position(2) ring(0)) legend(on order(1 "{stMono:`notjeb1'}" 2 "{stMono:`notjeb2'}" 3 "{fontface Baskerville Bold:Jeb!}")   size(*1.2)  col(1) position(4) ring(0) region(lstyle(none) fcolor(none)))

end
